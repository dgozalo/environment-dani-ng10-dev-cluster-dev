---
# Source: env/charts/jenkins-x-platform/charts/cleanup/templates/job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: cleanup
  labels:
    heritage: "Tiller"
    release: "jx-app-datadog"
    chart: "cleanup-2.3.89"
    component: "jx-app-datadog-cleanup"
  name: cleanup
  annotations:
    helm.sh/hook: pre-delete
    helm.sh/hook-delete-policy: hook-succeeded
    
spec:
  # backoffLimit: 5
  template:
    metadata:
      name: "jx-app-datadog"
      # istio-proxy prevents job pods from completing if istio is enabled
      # https://github.com/istio/istio/issues/6324
      annotations:
        sidecar.istio.io/inject: "false"
      labels:
        heritage: "Tiller"
        release: "jx-app-datadog"
        chart: "cleanup-2.3.89"
    spec:
      containers:
      - env:
        - name: KUBERNETES_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: "jenkinsxio/exposecontroller:2.3.89"
        name: cleanup
        command: ["/exposecontroller"]
        args:
        - "--cleanup"
      serviceAccountName: cleanup
      restartPolicy: Never